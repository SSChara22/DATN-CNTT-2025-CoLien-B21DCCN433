@startuml
left to right direction

skinparam classAttributeIconSize 0
skinparam roundcorner 10
skinparam shadowing false
skinparam linetype ortho

' Điều chỉnh cho layout ngang - ranksep là khoảng cách giữa các cột, nodesep là khoảng cách giữa các hàng
skinparam padding 1
skinparam nodesep 3
skinparam ranksep 8

skinparam class {
    BackgroundColor #E1F5FF
    BorderColor #0066CC
    ArrowColor #0066CC
    FontColor #000000
    FontStyle bold
}

skinparam package {
    BackgroundColor #F0F0F0
    BorderColor #666666
}

title Sơ đồ lớp thiết kế - Hệ thống E-commerce\n(Design Class Diagram - Horizontal Layout)

' ============================================
' CORE ENTITIES - Cột trái, hàng trên
' ============================================

package "Core Entities" #DDDDDD {
    class User {
        -id: Integer {PK}
        -email: String {unique}
        -password: String
        -firstName: String
        -lastName: String
        -roleId: String {FK}
        --
        +login(email: String, password: String): Object
        +addProductToCart(productId: Integer, quantity: Integer): Boolean
        +removeProductFromCart(cartId: Integer): Boolean
        +createOrder(addressId: Integer): OrderProduct
    }

    class Product {
        -id: Integer {PK}
        -name: String
        -categoryId: String {FK}
        -brandId: String {FK}
        -view: Integer
        --
        +createProduct(data: Object): Product
        +updateProduct(data: Object): Boolean
    }

    class ProductDetail {
        -id: Integer {PK}
        -productId: Integer {FK}
        -nameDetail: String
        -originalPrice: BigInteger
        -discountPrice: BigInteger
        --
        +getPrice(): BigInteger
    }

    class ProductDetailSize {
        -id: Integer {PK}
        -productdetailId: Integer {FK}
        -sizeId: String {FK}
        --
        +getSizeName(): String
        +checkStock(): Integer
    }

    class ProductImage {
        -id: Integer {PK}
        -productdetailId: Integer {FK}
        -image: Blob
    }

    class Allcode {
        -id: Integer {PK}
        -type: String
        -value: String
        -code: String {unique}
    }
}

' ============================================
' CART & ORDER - Cột phải, hàng trên
' ============================================

package "Cart & Order" #DDDDDD {
    class ShopCart {
        -id: Integer {PK}
        -userId: Integer {FK}
        -productdetailsizeId: Integer {FK}
        -quantity: Integer
        --
        +addToCart(userId: Integer, productDetailSizeId: Integer, quantity: Integer): ShopCart
        +removeFromCart(): Boolean
    }

    class OrderProduct {
        -id: Integer {PK}
        -addressUserId: Integer {FK}
        -statusId: String {FK}
        -typeShipId: Integer {FK}
        -voucherId: Integer {FK}
        --
        +createOrder(data: Object): OrderProduct
        +updateStatus(statusId: String): Boolean
        +calculateTotal(): BigInteger
    }

    class OrderDetail {
        -id: Integer {PK}
        -orderId: Integer {FK}
        -productId: Integer {FK}
        -quantity: Integer
        -realPrice: BigInteger
    }

    class ProductSelected {
        <<concept>>
        -id: Integer {PK}
        -productDetailSizeId: Integer {FK}
        -quantity: Integer
        -price: BigInteger
    }
}

' ============================================
' ADDRESS & SHIPPING - Cột trái, hàng giữa
' ============================================

package "Address & Shipping" #DDDDDD {
    class AddressUser {
        -id: Integer {PK}
        -userId: Integer {FK}
        -shipName: String
        -shipAdress: String
        -shipPhonenumber: String
    }

    class TypeShip {
        -id: Integer {PK}
        -type: String
        -price: BigInteger
    }
}

' ============================================
' VOUCHER SYSTEM - Cột phải, hàng giữa
' ============================================

package "Voucher System" #DDDDDD {
    class Voucher {
        -id: Integer {PK}
        -fromDate: String
        -toDate: String
        -typeVoucherId: Integer {FK}
        -amount: Integer
        -codeVoucher: String {unique}
        --
        +isValid(): Boolean
        +calculateDiscount(totalPrice: BigInteger): BigInteger
    }

    class TypeVoucher {
        -id: Integer {PK}
        -typeVoucher: String {FK}
        -value: BigInteger
        -maxValue: BigInteger
    }

    class VoucherUsed {
        -id: Integer {PK}
        -voucherId: Integer {FK}
        -userId: Integer {FK}
        -status: Integer
    }
}

' ============================================
' RECEIPT & SUPPLIER - Cột trái, hàng dưới
' ============================================

package "Receipt & Supplier" #DDDDDD {
    class Receipt {
        -id: Integer {PK}
        -userId: Integer {FK}
        -supplierId: Integer {FK}
    }

    class ReceiptDetail {
        -id: Integer {PK}
        -receiptId: Integer {FK}
        -productDetailSizeId: Integer {FK}
        -quantity: Integer
        -price: BigInteger
    }

    class Supplier {
        -id: Integer {PK}
        -name: String
        -address: String
        -phonenumber: String
    }
}

' ============================================
' INTERACTION & RECOMMENDATION - Cột phải, hàng dưới
' ============================================

package "Interaction & Recommendation" #DDDDDD {
    class Interaction {
        -interId: Integer {PK}
        -userId: Integer {FK}
        -productId: Integer {FK}
        -actionCode: String {FK}
        -timestamp: Date
    }

    class Recommendation {
        -id: Integer {PK}
        -userId: Integer {FK}
        -productId: Integer {FK}
        -modelName: String
        -score: Float
    }

    class Comment {
        -id: Integer {PK}
        -userId: Integer {FK}
        -productId: Integer {FK}
        -content: Text
        -star: Integer
    }
}

' ============================================
' CONCEPTUAL CLASSES - Ở giữa
' ============================================

class Variant {
    <<concept>>
    -id: Integer {PK}
    -productId: Integer {FK}
    -nameDetail: String
}

class SizeQuantity {
    <<concept>>
    -id: Integer {PK}
    -productdetailId: Integer {FK}
    -stock: Integer {calculated}
}

' ============================================
' NHÓM CÁC CLASS LIÊN QUAN LẠI GẦN NHAU
' ============================================

together {
    User, Product, ProductDetail, ProductDetailSize
}

together {
    ShopCart, OrderProduct, OrderDetail
}

together {
    Voucher, TypeVoucher, VoucherUsed
}

together {
    Receipt, ReceiptDetail, Supplier
}

together {
    Interaction, Recommendation, Comment
}

' ============================================
' RELATIONSHIPS CHÍNH
' ============================================

' User relationships
User "1" --> "0..1" Allcode : role >
User "1" --> "0..*" AddressUser : addresses >
User "1" --> "0..*" ShopCart : cart >
User "1" --> "0..*" OrderProduct : orders >
User "1" --> "0..*" Receipt : receipts >
User "1" --> "0..*" VoucherUsed : vouchers >
User "1" --> "0..*" Interaction : interactions >
User "1" --> "0..*" Recommendation : recommendations >
User "1" --> "0..*" Comment : comments >

' Product relationships
Product "1" --> "0..1" Allcode : category >
Product "1" --> "0..1" Allcode : brand >
Product "1" --> "0..*" ProductDetail : details >
Product "1" --> "0..*" Interaction : interactions >
Product "1" --> "0..*" Recommendation : recommended >
Product "1" --> "0..*" Comment : comments >

' ProductDetail relationships
ProductDetail "1" --> "1" Product : belongs >
ProductDetail "1" --> "0..*" ProductImage : images >
ProductDetail "1" --> "0..*" ProductDetailSize : sizes >

' ProductDetailSize relationships
ProductDetailSize "1" --> "1" ProductDetail : belongs >
ProductDetailSize "1" --> "0..1" Allcode : size >
ProductDetailSize "1" --> "0..*" ShopCart : in cart >
ProductDetailSize "1" --> "0..*" OrderDetail : in orders >
ProductDetailSize "1" --> "0..*" ReceiptDetail : in receipts >

' Variant & SizeQuantity
Variant "1" --> "0..*" SizeQuantity : contains >
Variant "1" --> "1" Product : belongs >
SizeQuantity "1" --> "1" ProductDetailSize : represents >

' ShopCart relationships
ShopCart "1" --> "1" User : belongs >
ShopCart "1" --> "1" ProductDetailSize : references >

' ProductSelected relationships
ProductSelected "1" --> "1" ProductDetailSize : references >
ProductSelected "0..*" --> "1" OrderProduct : in order >

' OrderProduct relationships
OrderProduct "1" --> "1" AddressUser : ships to >
OrderProduct "1" --> "0..1" TypeShip : shipping >
OrderProduct "1" --> "0..1" Voucher : voucher >
OrderProduct "1" --> "0..1" Allcode : status >
OrderProduct "1" --> "0..1" User : shipper >
OrderProduct "1" --> "1..*" OrderDetail : contains >

' OrderDetail - QUAN TRỌNG: trỏ đến ProductDetailSize
OrderDetail "1" --> "1" OrderProduct : belongs >
OrderDetail "1" --> "1" ProductDetailSize : references >

' AddressUser relationships
AddressUser "1" --> "1" User : belongs >
AddressUser "1" --> "0..*" OrderProduct : used in >

' Voucher relationships
Voucher "1" --> "1" TypeVoucher : has type >
Voucher "1" --> "0..*" OrderProduct : used in >
Voucher "1" --> "0..*" VoucherUsed : usage >

' TypeVoucher relationships
TypeVoucher "1" --> "0..1" Allcode : type code >
TypeVoucher "1" --> "0..*" Voucher : vouchers >

' VoucherUsed relationships
VoucherUsed "1" --> "1" Voucher : references >
VoucherUsed "1" --> "1" User : used by >

' Receipt relationships
Receipt "1" --> "1" User : created by >
Receipt "1" --> "1" Supplier : from >
Receipt "1" --> "1..*" ReceiptDetail : contains >

' ReceiptDetail relationships
ReceiptDetail "1" --> "1" Receipt : belongs >
ReceiptDetail "1" --> "1" ProductDetailSize : references >

' Supplier relationships
Supplier "1" --> "0..*" Receipt : supplies >

' Interaction relationships
Interaction "1" --> "1" User : performed by >
Interaction "1" --> "1" Product : on product >
Interaction "1" --> "0..1" Allcode : action type >

' Recommendation relationships
Recommendation "1" --> "1" User : for user >
Recommendation "1" --> "1" Product : recommends >

' Comment relationships
Comment "1" --> "1" User : written by >
Comment "1" --> "0..1" Product : comments on >

' ============================================
' AGGREGATION & COMPOSITION
' ============================================

OrderProduct *-- "1..*" OrderDetail : contains
Receipt *-- "1..*" ReceiptDetail : contains
ProductDetail *-- "0..*" ProductDetailSize : contains
Variant *-- "0..*" SizeQuantity : contains
OrderProduct o-- "0..*" ProductSelected : aggregates

' ============================================
' NOTES QUAN TRỌNG
' ============================================

note right of OrderDetail
  **QUAN TRỌNG**
  OrderDetail.productId trỏ đến
  ProductDetailSize.id
  (không phải ProductDetail.id)
end note

note top of OrderProduct
  **Trạng thái đơn hàng:**
  S3 (Pending) → S4 (Confirmed) →
  S5 (Shipping) → S6 (Delivered) →
  S7 (Cancelled)
end note

@enduml
