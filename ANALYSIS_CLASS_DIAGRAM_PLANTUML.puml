@startuml
skinparam classAttributeIconSize 0
skinparam roundcorner 5
skinparam shadowing false
skinparam linetype ortho

' Tối ưu spacing cho hình vuông
skinparam padding 1
skinparam nodesep 2
skinparam ranksep 2

skinparam class {
    BackgroundColor #E1F5FF
    BorderColor #0066CC
    ArrowColor #0066CC
    FontColor #000000
    FontStyle bold
    FontSize 7
}

skinparam classAbstract {
    BackgroundColor #FFF4CC
    BorderColor #FF9900
    FontColor #000000
    FontStyle bold
    FontSize 7
}

skinparam package {
    BackgroundColor #F0F0F0
    BorderColor #666666
    FontColor #000000
    FontStyle bold
    FontSize 8
}

title Biểu đồ lớp phân tích - Hệ thống E-commerce\n(Analysis Class Diagram - Ultra Compact)

' ============================================
' CORE DOMAIN
' ============================================
package "Core" #DDDDDD {
    class User {
        +id: Integer {PK}
        +email: String
    }
    
    class Product {
        +id: Integer {PK}
        +name: String
    }
    
    class Order {
        +id: Integer {PK}
        +totalPrice: Float
    }
    
    class Recommendation {
        +id: Integer {PK}
        +score: Float
    }
}

' ============================================
' PRODUCT DOMAIN
' ============================================
package "Product" #DDDDDD {
    class ProductDetail {
        +id: Integer {PK}
        +originalPrice: Float
        +discountPrice: Float
    }
    
    class ProductDetailSize {
        +id: Integer {PK}
        +sizeName: String
        +quantity: Integer
    }
    
    class Allcode {
        +code: String {PK}
        +value: String
    }
}

' ============================================
' ORDER DOMAIN
' ============================================
package "Order" #DDDDDD {
    class OrderDetail {
        +id: Integer {PK}
        +quantity: Integer
        +unitPrice: Float
    }
    
    class AddressUser {
        +id: Integer {PK}
        +fullName: String
    }
    
    class TypeShip {
        +id: Integer {PK}
        +price: Float
    }
}

' ============================================
' INTERACTION
' ============================================
package "Interaction" #DDDDDD {
    class Interaction {
        +id: Integer {PK}
        +actionCode: String
    }
    
    class Comment {
        +id: Integer {PK}
        +star: Integer
    }
}

' ============================================
' SHOPPING
' ============================================
package "Shopping" #DDDDDD {
    class ShopCart {
        +id: Integer {PK}
        +quantity: Integer
    }
    
    class Voucher {
        +id: Integer {PK}
        +code: String
        +discountValue: Float
    }
}

' ============================================
' SUPPLY CHAIN
' ============================================
package "Supply Chain" #DDDDDD {
    class Receipt {
        +id: Integer {PK}
        +totalAmount: Float
    }
    
    class ReceiptDetail {
        +id: Integer {PK}
        +quantity: Integer
    }
    
    class Supplier {
        +id: Integer {PK}
        +name: String
    }
}

' ============================================
' ML DOMAIN
' ============================================
package "ML Domain" #DDDDDD {
    abstract class RecommendationModel {
        <<abstract>>
        +predict(): Float[]
    }
    
    class ENCM {
        +predict(): Float[]
    }
    
    class LNCM {
        +predict(): Float[]
    }
    
    class NeuMF {
        +predict(): Float[]
    }
    
    class BMF {
        +predict(): Float[]
    }
    
    class RecommendationEngine {
        +generateRecommendations(): Recommendation[]
    }
}

' ============================================
' NHÓM CÁC CLASS LIÊN QUAN
' ============================================

together {
    User, Product, Order, Recommendation
}

together {
    ProductDetail, ProductDetailSize, Allcode
}

together {
    OrderDetail, AddressUser, TypeShip
}

together {
    Interaction, Comment
}

together {
    ShopCart, Voucher
}

together {
    Receipt, ReceiptDetail, Supplier
}

together {
    RecommendationModel, ENCM, LNCM, NeuMF, BMF, RecommendationEngine
}

' ============================================
' RELATIONSHIPS - Chỉ giữ relationships chính nhất
' ============================================

' User relationships
User "1" --> "0..*" Order : places
User "1" --> "0..*" ShopCart : has
User "1" --> "0..*" Recommendation : receives
User "1" --> "0..*" Interaction : performs
User "1" --> "0..*" Comment : writes
User "1" --> "0..*" AddressUser : has

' Product relationships
Product "1" --> "0..*" ProductDetail : has
Product "1" --> "0..*" ProductDetailSize : has
Product "1" --> "0..*" Recommendation : recommended_in
Product "1" --> "0..*" Interaction : interacted_with
Product "1" --> "0..*" Comment : has
Product "1" --> "1" Allcode : category
Product "1" --> "1" Allcode : brand

' Order relationships
Order "1" --> "0..*" OrderDetail : contains
Order "1" --> "1" User : belongs_to
Order "1" --> "0..1" AddressUser : ships_to
Order "1" --> "0..1" TypeShip : uses
Order "1" --> "0..1" Voucher : applies

' Recommendation relationships
Recommendation "1" --> "1" User : for
Recommendation "1" --> "1" Product : recommends

' Interaction relationships
Interaction "1" --> "1" User : performed_by
Interaction "1" --> "1" Product : on

' Comment relationships
Comment "1" --> "1" User : written_by
Comment "1" --> "0..1" Product : on

' ShopCart relationships
ShopCart "1" --> "1" User : belongs_to
ShopCart "1" --> "1" Product : contains

' Receipt relationships
Receipt "1" --> "0..*" ReceiptDetail : contains
Receipt "1" --> "1" Supplier : from

' ML Domain relationships
RecommendationEngine "1" --> "1..*" RecommendationModel : uses
RecommendationModel <|-- ENCM
RecommendationModel <|-- LNCM
RecommendationModel <|-- NeuMF
RecommendationModel <|-- BMF
RecommendationEngine --> User : generates_for
RecommendationEngine --> Product : recommends

@enduml
